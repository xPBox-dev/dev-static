(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[500],{53266:function(k){k.exports={tabs:"tabs___YEat-"}},45572:function(k,X,e){"use strict";var A=e(68023),G=e(99935),q=e(48579),R=e(46586),_=e(17813),lt=e(19076),Q=e(62842),it=e(68290),V=e(62604),T=e(70012);A.D([_.N,lt.N,Q.N,q.N,T.N,it.N,V.N,R.N]),X.Z=G},19151:function(k,X,e){"use strict";e.r(X),e.d(X,{default:function(){return Wt}});var A=e(33565),G=e(57361),q=e(9754),R=e.n(q),_=e(19797),lt=e(3515),Q=e(85461),it=e(13254),V=e(14277),T=e(96132),kt=e(22385),Zt=e(69713),Y=e(37730),dt=e(21349),H=e(23723),c=e(67294),v=e(84787),jt=e(53266),ut=e.n(jt),Et=e(73727),h=e(21010),It=e(16894),At=e(7110),C=e(56905),L=e(52778),Ct=e(4084),t=e(85893),tt=L.Z.Statistic,St=L.Z.Divider,Pt=function(l){var s=l.loading,a=l.active,p=(0,c.useState)(!1),Z=(0,A.Z)(p,2),m=Z[0],y=Z[1];return(0,t.jsx)(Ct.Z,{onResize:function(B){y(B.width<696)},children:(0,t.jsxs)(L.Z.Group,{loading:s,direction:m?"column":"row",style:{marginBottom:24},children:[(0,t.jsx)(L.Z,{statistic:{title:"\u5F53\u524D\u5B9E\u4F8B\u6570",value:(a==null?void 0:a.current)||0,description:(0,t.jsx)(tt,{title:"\u6628\u65E5\u5CF0\u503C",value:(a==null?void 0:a.max)||0})}}),(0,t.jsx)(St,{type:m?"horizontal":"vertical"}),(0,t.jsx)(L.Z,{statistic:{title:"24\u5C0F\u65F6\u6D3B\u8DC3\u5EA6",value:a==null?void 0:a.h24,description:(0,t.jsx)(tt,{title:"\u6628\u65E5\u540C\u6BD4",value:(a==null?void 0:a.hc)==="-"?"-":(a==null?void 0:a.hc)+"%",trend:(a==null?void 0:a.hc)<0?"down":"up"})},chartPlacement:"left"}),(0,t.jsx)(L.Z,{statistic:{title:"\u672C\u6708\u6D3B\u8DC3\u5EA6",value:a==null?void 0:a.month,description:(0,t.jsx)(tt,{title:"\u4E0A\u6708\u540C\u6BD4",value:(a==null?void 0:a.mc)==="-"?"-":(a==null?void 0:a.mc)+"%",trend:(a==null?void 0:a.mc)<0?"down":"up"})},chartPlacement:"left"})]})},"resize-observer")},ct=Pt,vt=e(13718);function ht(d){for(var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,s=d.indexOf("/"),a=0;a<l&&s!==-1;a++)s=d.indexOf("/",s+1);return s!==-1?d.substr(0,s):d}var Dt=function(l){var s,a,p,Z,m,y=l.showAll,E=l.userId,B=c.useState("hour"),F=(0,A.Z)(B,2),g=F[0],S=F[1];c.useEffect(function(){I.run(),g==="hour"?x.reset():x.run()},[E]);var I=(0,h.QT)(function(){return y?(0,C.Pf)({hour:!0,base:!0,userId:E}):(0,C.s8)({hour:!0,base:!0})},{manual:!0}),x=(0,h.QT)(function(){return y?(0,C.Pf)({month:!0,userId:E}):(0,C.s8)({month:!0})},{manual:!0}),i=[{title:"\u5E94\u7528\u540D",dataIndex:"appName",key:"appName",render:function(r,j){return(0,t.jsx)(Zt.Z,{placement:"top",title:j.appId,children:(0,t.jsx)(Et.rU,{to:ht(h.m8.location.pathname)+"/"+j.id,children:r})})}}].concat((0,Y.Z)(y?[{title:"\u7528\u6237",dataIndex:"userId",key:"userId",copyable:!0,render:function(r,j){return(0,t.jsxs)(t.Fragment,{children:[j.nick," (",j.email,")"]})}}]:[]),[{title:"\u6D3B\u8DC3\u5EA6",dataIndex:"active",key:"active",hideInSearch:!0},{title:"\u5E73\u5747\u6D3B\u8DC3\u8BBE\u5907",dataIndex:"device",key:"device",hideInSearch:!0},{title:"\u542F\u52A8\u6B21\u6570",dataIndex:"count",key:"count",hideInSearch:!0}]),z={appendPadding:10,height:400,data:g==="hour"?((s=I.data)===null||s===void 0?void 0:s.hour.rank)||[]:((a=x.data)===null||a===void 0?void 0:a.month.rank)||[],angleField:"value",colorField:"type",radius:.8,loading:g==="hour"?I.loading:x.loading,label:{type:"outer",content:"{name} {percentage}"},onReady:function(r){r.on("element:click",function(j){h.m8.push(ht(h.m8.location.pathname)+"/"+j.data.data.id)})},interactions:[{type:"pie-legend-active"},{type:"element-active"}]},U=(0,t.jsxs)(v.ZP,{split:"horizontal",children:[(0,t.jsx)(v.ZP,{bodyStyle:{padding:0},style:{marginTop:10},children:(0,t.jsx)(It.ZP,{headerTitle:"\u6D3B\u8DC3\u5E94\u7528\u5217\u8868",params:(0,T.Z)({},g==="hour"?{type:1}:{type:2}),rowKey:"id",search:!1,request:y?C.Up:C.IX,scroll:{x:600},options:{fullScreen:!0,reload:!0,setting:!0},columns:i})}),(0,t.jsx)(v.ZP,{title:"TOP10\u6D3B\u8DC3\u5E94\u7528",collapsible:!0,style:{position:"relative"},bodyStyle:{height:"auto"},children:(g==="hour"?(((p=I.data)===null||p===void 0?void 0:p.hour.rank)||[]).length===0:(((Z=x.data)===null||Z===void 0?void 0:Z.month.rank)||[]).length===0)?(0,t.jsx)(V.Z,{image:V.Z.PRESENTED_IMAGE_SIMPLE}):(0,t.jsx)(At.Z,(0,T.Z)({},z))})]});return(0,t.jsx)(dt.Z,{children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.Suspense,{fallback:(0,t.jsx)(H.Z,{}),children:(0,t.jsx)(ct,{loading:I.loading,active:(m=I.data)===null||m===void 0?void 0:m.base})}),(0,t.jsxs)(c.Suspense,{fallback:(0,t.jsx)(H.Z,{}),children:[(0,t.jsx)(Q.Z,{offsetTop:vt.M,style:{overflow:"hidden"},children:(0,t.jsxs)(v.ZP,{className:ut().tabs,tabs:{tabPosition:"top",size:"large",activeKey:g,onChange:function(r){S(r),r==="month"&&!x.data&&!x.loading&&x.run()}},style:{boxShadow:"0 0 5px #00000044"},children:[(0,t.jsx)(v.ZP.TabPane,{tab:"24\u5C0F\u65F6\u62A5",cardProps:{bodyStyle:{padding:0}}},"hour"),(0,t.jsx)(v.ZP.TabPane,{tab:"\u6708\u62A5",cardProps:{bodyStyle:{padding:0}}},"month")]})}),(0,t.jsx)(v.ZP,{bodyStyle:{padding:0},children:U})]})]})})},bt=Dt,qt=e(14965),Bt=e(14072),_t=e(64896),Ot=e(37744),te=e(57663),et=e(71577),ee=e(58024),ft=e(39144),ae=e(20228),at=e(11382),pt=e(65476),Tt=e(84744),Ft=e(46360),$t=e.n(Ft),Mt=e(97221),nt=e(57845),mt=e(45572),xt=e(87155),Rt=e(30381),o=e.n(Rt);function yt(d){for(var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,s=d.indexOf("/"),a=0;a<l&&s!==-1;a++)s=d.indexOf("/",s+1);return s!==-1?d.substr(0,s):d}var Lt=function(l){var s,a,p,Z,m,y,E,B,F,g,S,I=l.showAll,x=l.userId,i=l.appId,z=l.setAppId,U=c.useState("current"),$=(0,A.Z)(U,2),r=$[0],j=$[1],J=c.useState(i===""?[]:[{value:i,label:(0,t.jsx)(at.Z,{size:"small"}),disabled:!0}]),K=(0,A.Z)(J,2),w=K[0],zt=K[1],O=c.useRef({instance:!0,device:!1,count:!1}),Xt=c.useState({start:0,end:0}),gt=(0,A.Z)(Xt,2),f=gt[0],Gt=gt[1];function Qt(u){return rt.apply(this,arguments)}function rt(){return rt=(0,G.Z)(R().mark(function u(n){return R().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.abrupt("return",(0,Tt.yC)((0,T.Z)((0,T.Z)({search:n},I?{all:I}:{}),x!==0?{userId:x}:{})));case 1:case"end":return b.stop()}},u)})),rt.apply(this,arguments)}var N=(0,h.QT)(function(){return(0,C.CF)({current:!0,base:!0,appId:i})},{manual:i===""}),P=(0,h.QT)(function(){return(0,C.Xf)({appId:i,stat:"instance",type:r,start:f.start,end:f.end})},{manual:i===""}),D=(0,h.QT)(function(){return(0,C.Xf)({appId:i,stat:"device",type:r,start:f.start,end:f.end})},{manual:!0}),M=(0,h.QT)(function(){return(0,C.Xf)({appId:i,stat:"count",type:r,start:f.start,end:f.end})},{manual:!0}),ot=function(n){O.current.instance?P.run():P.reset(),O.current.device?D.run():D.reset(),O.current.count?M.run():M.reset(),n&&N.run()},Vt=function(n){var W=f.start!==0&&n.format("X")/86400-f.start/24>365,b=f.end!==0&&f.end/24-n.format("X")/86400>365;return n&&n>o()().endOf("day")||b||W};(0,nt.e)(function(){ot(!0)},[i]),(0,nt.e)(function(){ot(!1)},[r]),(0,nt.e)(function(){!(r==="custom"&&(f.start===0||f.end===0))&&ot(!1)},[f]),(0,c.useEffect)(function(){var u,n;zt([{value:(u=N.data)===null||u===void 0?void 0:u.id,label:(n=N.data)===null||n===void 0?void 0:n.title}])},[N.data]);var Yt=(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(pt.Z,(0,T.Z)((0,T.Z)({showSearch:!0},i===""?{}:{value:i}),{},{placeholder:"\u9009\u62E9\u5E94\u7528",fetchOptions:Qt,setMyOption:w,style:{minWidth:"200px",maxWidth:"350px"},onChange:function(n){z(n),h.m8.push(yt(h.m8.location.pathname)+"/"+n)}}))}),Ht={tooltip:{trigger:"axis"},legend:{data:["\u6D3B\u8DC3\u8BBE\u5907\u6570","\u5E73\u5747\u6D3B\u8DC3\u65F6\u95F4"].concat((0,Y.Z)(r==="current"?["\u7D2F\u8BA1\u6D3B\u8DC3\u8BBE\u5907"]:[]))},grid:{top:"30px",left:"10px",right:"10px",bottom:"50px",containLabel:!0},xAxis:[{type:"category",boundaryGap:!1,data:(s=D.data)===null||s===void 0?void 0:s.x}],yAxis:[{name:"\u8BBE\u5907\u6570",type:"value",minInterval:1},{name:"\u6D3B\u8DC3\u65F6\u95F4(\u79D2)",type:"value",max:3600}],dataZoom:[{show:!0,xAxisIndex:0,start:r==="current"?66.666:0}],series:[].concat((0,Y.Z)(r==="current"?[{name:"\u7D2F\u8BA1\u6D3B\u8DC3\u8BBE\u5907",type:"custom",stack:"\u7D2F\u8BA1\u6D3B\u8DC3\u8BBE\u5907",renderItem:function(){},data:[(a=D.data)===null||a===void 0?void 0:a.total],encode:{x:0,y:0,tooltip:0},markLine:{data:[{type:"max",name:"\u672C\u65E5\u7D2F\u8BA1\u6D3B\u8DC3\u5B9E\u4F8B",label:{position:"insideStartTop",formatter:"\u672C\u65E5\u7D2F\u8BA1\u6D3B\u8DC3\u5B9E\u4F8B"},tooltip:{trigger:"item"},yAxis:(p=D.data)===null||p===void 0?void 0:p.total}]}}]:[]),[{name:"\u6D3B\u8DC3\u8BBE\u5907\u6570",type:"line",smooth:!0,stack:"\u8BBE\u5907\u6570",color:"#D23325",data:(Z=D.data)===null||Z===void 0?void 0:Z.instance},{name:"\u5E73\u5747\u6D3B\u8DC3\u65F6\u95F4",type:"line",yAxisIndex:1,smooth:!0,color:"#5888F3",areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#1890ff"},{offset:.5,color:"#7ec2f3"},{offset:1,color:"#ffffff"}],global:!1}},stack:"\u65F6\u95F4",data:(m=D.data)===null||m===void 0?void 0:m.time}])},Jt={tooltip:{trigger:"axis"},legend:{data:["\u6D3B\u8DC3\u5B9E\u4F8B\u6570","\u5E73\u5747\u6D3B\u8DC3\u65F6\u95F4","\u7D2F\u8BA1\u6D3B\u8DC3\u5B9E\u4F8B"]},grid:{top:"30px",left:"10px",right:"10px",bottom:"50px",containLabel:!0},xAxis:[{type:"category",boundaryGap:!1,data:(y=P.data)===null||y===void 0?void 0:y.x}],yAxis:[{name:"\u5B9E\u4F8B\u6570",type:"value",minInterval:1},{name:"\u6D3B\u8DC3\u65F6\u95F4(\u79D2)",type:"value",max:3600}],dataZoom:[{show:!0,xAxisIndex:0,start:r==="current"?66.666:0}],series:[].concat((0,Y.Z)(r==="current"?[{name:"\u7D2F\u8BA1\u6D3B\u8DC3\u5B9E\u4F8B",type:"custom",stack:"\u7D2F\u8BA1\u6D3B\u8DC3\u5B9E\u4F8B",renderItem:function(){},data:[(E=P.data)===null||E===void 0?void 0:E.total],encode:{x:0,y:0,tooltip:0},markLine:{data:[{type:"max",name:"\u672C\u65E5\u7D2F\u8BA1\u6D3B\u8DC3\u5B9E\u4F8B",label:{position:"insideStartTop",formatter:"\u672C\u65E5\u7D2F\u8BA1\u6D3B\u8DC3\u5B9E\u4F8B"},tooltip:{trigger:"item"},yAxis:(B=P.data)===null||B===void 0?void 0:B.total}]}}]:[]),[{name:"\u6D3B\u8DC3\u5B9E\u4F8B\u6570",type:"line",smooth:!0,stack:"\u5B9E\u4F8B\u6570",color:"#D23325",data:(F=P.data)===null||F===void 0?void 0:F.instance},{name:"\u5E73\u5747\u6D3B\u8DC3\u65F6\u95F4",type:"line",yAxisIndex:1,smooth:!0,color:"#5888F3",areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#1890ff"},{offset:.5,color:"#7ec2f3"},{offset:1,color:"#ffffff"}],global:!1}},stack:"\u65F6\u95F4",data:(g=P.data)===null||g===void 0?void 0:g.time}])},wt=r==="custom"&&(f.start===0||f.end===0)?(0,t.jsx)(ft.Z,{bordered:!1,children:"\u8BF7\u9009\u62E9\u4E00\u4E2A\u65F6\u95F4\u6BB5"}):(0,t.jsxs)(v.ZP,{split:"horizontal",children:[(0,t.jsx)(v.ZP,{collapsible:!0,defaultCollapsed:!O.current.instance,title:"\u6D3B\u8DC3\u5B9E\u4F8B\u8D8B\u52BF",style:{position:"relative"},onCollapse:function(n){O.current.instance=!n,!P.data&&P.run()},children:(0,t.jsx)(at.Z,{spinning:P.loading,children:(0,t.jsx)(xt.Z,{notMerge:!0,echarts:mt.Z,option:Jt,style:{height:300}})})}),(0,t.jsx)(v.ZP,{collapsible:!0,defaultCollapsed:!O.current.device,title:"\u6D3B\u8DC3\u8BBE\u5907\u8D8B\u52BF",style:{position:"relative"},onCollapse:function(n){O.current.device=!n,!D.data&&D.run()},children:(0,t.jsx)(at.Z,{spinning:D.loading,children:(0,t.jsx)(xt.Z,{notMerge:!0,echarts:mt.Z,option:Ht,style:{height:300}})})}),(0,t.jsx)(v.ZP,{collapsible:!0,defaultCollapsed:!O.current.count,title:"\u542F\u52A8\u6B21\u6570\u8D8B\u52BF",style:{position:"relative"},bodyStyle:{height:"auto"},onCollapse:function(n){O.current.count=!n,!M.data&&M.run()},children:(0,t.jsx)(Mt.Z,{loading:M.loading||!M.data,height:300,data:M.data||[],xField:"x",yField:"y",xAxis:{visible:!0},yAxis:{visible:!0,title:{visible:!1}},slider:{start:r==="current"?.6666:0,end:1},title:{visible:!0,text:"\u542F\u52A8\u6B21\u6570\u8D8B\u52BF",style:{fontSize:14}},meta:{y:{alias:"\u542F\u52A8\u6B21\u6570"}}})})]});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Ot.Z,{className:$t().header,title:Yt,subTitle:"\u7684\u7EDF\u8BA1\u4FE1\u606F",extra:i&&(0,t.jsxs)(et.Z.Group,{children:[(0,t.jsx)(et.Z,{onClick:function(){h.m8.push(yt(h.m8.location.pathname,1)+"/install/"+i)},children:"\u5B89\u88C5\u7EDF\u8BA1"}),(0,t.jsx)(et.Z,{onClick:function(){h.m8.push("/app/detail/"+i)},children:"\u5E94\u7528\u8BE6\u60C5"})]}),style:{padding:0,marginBottom:20}}),i?(0,t.jsx)(dt.Z,{children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.Suspense,{fallback:(0,t.jsx)(H.Z,{}),children:(0,t.jsx)(ct,{loading:N.loading,active:(S=N.data)===null||S===void 0?void 0:S.base})}),(0,t.jsxs)(c.Suspense,{fallback:(0,t.jsx)(H.Z,{}),children:[(0,t.jsx)(Q.Z,{offsetTop:vt.M,style:{overflow:"hidden"},children:(0,t.jsxs)(v.ZP,{className:ut().tabs,tabs:{tabPosition:"top",size:"middle",activeKey:r,onChange:function(n){j(n)}},style:{boxShadow:"0 0 5px #00000044"},children:[(0,t.jsx)(v.ZP.TabPane,{tab:"\u8FD124\u5C0F\u65F6",cardProps:{bodyStyle:{padding:0}}},"current"),(0,t.jsx)(v.ZP.TabPane,{tab:"\u8FD1\u4E00\u4E2A\u6708",cardProps:{bodyStyle:{padding:0}}},"month"),(0,t.jsx)(v.ZP.TabPane,{tab:(0,t.jsxs)(t.Fragment,{children:["\u81EA\u5B9A\u4E49:",(0,t.jsx)(Bt.Z.RangePicker,{bordered:!1,disabledDate:Vt,ranges:{\u4ECA\u65E5:[o()(),o()()],\u672C\u5468:[o()().startOf("week"),o()()],\u672C\u6708:[o()().startOf("month"),o()()],\u8FC7\u53BB7\u5929:[o()().subtract(7,"day"),o()()],\u8FC7\u53BB30\u5929:[o()().subtract(30,"day"),o()()],\u8FC7\u53BB60\u5929:[o()().subtract(60,"day"),o()()],\u8FC7\u53BB90\u5929:[o()().subtract(90,"day"),o()()],\u8FC7\u53BB120\u5929:[o()().subtract(120,"day"),o()()],\u8FC7\u53BB180\u5929:[o()().subtract(180,"day"),o()()],\u8FC7\u53BB360\u5929:[o()().subtract(360,"day"),o()()]},onCalendarChange:function(n){var W,b;return Gt(n?{start:parseInt(((W=n[0])===null||W===void 0?void 0:W.startOf("day").format("X"))/3600)|0,end:parseInt(((b=n[1])===null||b===void 0?void 0:b.startOf("day").format("X"))/3600)|0}:{start:0,end:0})}})]}),cardProps:{bodyStyle:{padding:0}}},"custom")]})}),(0,t.jsx)(v.ZP,{bodyStyle:{padding:0},children:wt})]})]})}):(0,t.jsx)(ft.Z,{bodyStyle:{textAlign:"center"},children:"\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u5E94\u7528"})]})},Ut=Lt,Kt=e(6637);function Nt(d){return st.apply(this,arguments)}function st(){return st=(0,G.Z)(R().mark(function d(l){return R().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,Kt.y)({search:l}));case 1:case"end":return a.stop()}},d)})),st.apply(this,arguments)}var Wt=function(d){var l=d.route.name==="all-instance",s=c.useState(d.match.params.appId?d.match.params.appId:""),a=(0,A.Z)(s,2),p=a[0],Z=a[1],m=c.useRef(p?"detail":"overview"),y=(0,h.tT)("admin"),E=y.selectedUser,B=y.setData,F=(0,c.useState)(E.value),g=(0,A.Z)(F,2),S=g[0],I=g[1],x=(0,t.jsx)(bt,{showAll:l,userId:S}),i=(0,t.jsx)(Ut,{showAll:l,userId:S,appId:p,setAppId:Z}),z=c.useState(p?i:x),U=(0,A.Z)(z,2),$=U[0],r=U[1];(0,c.useEffect)(function(){j()},[S,p]);var j=function(){m.current==="overview"?r(x):r(i)};return(0,t.jsx)(_.ZP,{tabList:[{tab:"\u6982\u89C8",key:"overview"},{tab:"\u8BE6\u7EC6\u8D8B\u52BF",key:"detail"}],tabActiveKey:m.current,content:l&&(0,t.jsxs)(t.Fragment,{children:["\u5F00\u53D1\u8005\uFF1A",(0,t.jsx)(pt.Z,{showAll:!0,showSearch:!0,placeholder:"\u9009\u62E9\u7528\u6237",setMyOption:[E],fetchOptions:Nt,defaultValue:S,style:{width:"250px"},onChange:function(K,w){I(K),B({label:w.label,value:w.value})}})]}),onTabChange:function(K){m.current=K,j()},children:$})}}}]);
