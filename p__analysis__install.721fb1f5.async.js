(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[110],{33053:function(H){H.exports={tabs:"tabs___2_QYX"}},55457:function(H,J,a){"use strict";a.r(J),a.d(J,{default:function(){return $t}});var A=a(33565),w=a(57361),st=a(9754),Q=a.n(st),it=a(19797),Ot=a(3515),k=a(85461),Mt=a(13254),N=a(14277),$=a(96132),zt=a(22385),dt=a(69713),ot=a(37730),q=a(21349),G=a(23723),u=a(67294),v=a(84787),ut=a(33053),_=a.n(ut),f=a(21010),ct=a(73727),vt=a(16894),K=a(7110),P=a(56905),R=a(52778),ht=a(4084),t=a(85893),X=R.Z.Statistic,pt=R.Z.Divider,ft=function(d){var r=d.loading,e=d.active,x=(0,u.useState)(!1),s=(0,A.Z)(x,2),Z=s[0],C=s[1];return(0,t.jsx)(ht.Z,{onResize:function(m){C(m.width<696)},children:(0,t.jsxs)(R.Z.Group,{loading:r,direction:Z?"column":"row",style:{marginBottom:24},children:[(0,t.jsx)(R.Z,{statistic:{title:"\u4ECA\u65E5\u5B89\u88C5\u91CF",value:(e==null?void 0:e.current)||0,description:(0,t.jsx)(X,{title:"\u672C\u6708\u5CF0\u503C",value:(e==null?void 0:e.max)||0})}}),(0,t.jsx)(pt,{type:Z?"horizontal":"vertical"}),(0,t.jsx)(R.Z,{statistic:{title:"\u6628\u65E5\u5B89\u88C5\u91CF",value:e==null?void 0:e.yesterday,description:(0,t.jsx)(X,{title:"\u524D\u65E5\u540C\u6BD4",value:(e==null?void 0:e.yc)==="-"?"-":(e==null?void 0:e.yc)+"%",trend:(e==null?void 0:e.yc)<0?"down":"up"})},chartPlacement:"left"}),(0,t.jsx)(R.Z,{statistic:{title:"\u672C\u6708\u5B89\u88C5\u91CF",value:e==null?void 0:e.month,description:(0,t.jsx)(X,{title:"\u4E0A\u6708\u540C\u6BD4",value:(e==null?void 0:e.mc)==="-"?"-":(e==null?void 0:e.mc)+"%",trend:(e==null?void 0:e.mc)<0?"down":"up"})},chartPlacement:"left"})]})},"resize-observer")},tt=ft,et=a(13718);function at(o){for(var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,r=o.indexOf("/"),e=0;e<d&&r!==-1;e++)r=o.indexOf("/",r+1);return r!==-1?o.substr(0,r):o}var mt=function(d){var r,e,x,s,Z,C,b,m,B,F=d.showAll,S=d.userId,U=u.useState("current"),D=(0,A.Z)(U,2),c=D[0],L=D[1];u.useEffect(function(){h.run(),c==="current"?n.reset():n.run()},[S]);var h=(0,f.QT)(function(){return F?(0,P.K1)({current:!0,base:!0,userId:S}):(0,P.P)({current:!0,base:!0})},{manual:!0}),n=(0,f.QT)(function(){return F?(0,P.K1)({month:!0,userId:S}):(0,P.P)({month:!0})},{manual:!0}),O=[{title:"\u5E94\u7528\u540D",dataIndex:"appName",key:"appName",render:function(g,I){return(0,t.jsx)(dt.Z,{placement:"top",title:I.appId,children:(0,t.jsx)(ct.rU,{to:at(f.m8.location.pathname)+"/"+I.id,children:g})})}}].concat((0,ot.Z)(F?[{title:"\u7528\u6237",dataIndex:"userId",key:"userId",copyable:!0,render:function(g,I){return(0,t.jsxs)(t.Fragment,{children:[I.nick," (",I.email,")"]})}}]:[]),[{title:"\u5E94\u7528\u5546\u5E97\u5B89\u88C5",dataIndex:"install_store",key:"install_store",hideInSearch:!0},{title:"\u5E94\u7528ID\u5B89\u88C5",dataIndex:"install_app_id",key:"install_app_id",hideInSearch:!0},{title:"\u6587\u4EF6\u5B89\u88C5",dataIndex:"install_file",key:"install_file",hideInSearch:!0},{title:"\u5E94\u7528\u5B89\u88C5",dataIndex:"install_app",key:"install_app",hideInSearch:!0},{title:"\u542F\u52A8\u5668\u5B89\u88C5",dataIndex:"install_loader",key:"install_loader",hideInSearch:!0}]),M={appendPadding:10,height:400,data:c==="current"?((r=h.data)===null||r===void 0?void 0:r.current.rank)||[]:((e=n.data)===null||e===void 0?void 0:e.month.rank)||[],angleField:"value",colorField:"type",radius:.8,loading:c==="current"?h.loading:n.loading,label:{type:"outer",content:"{name} {percentage}"},onReady:function(g){g.on("element:click",function(I){f.m8.push(at(f.m8.location.pathname)+"/"+I.data.data.id)})},interactions:[{type:"pie-legend-active"},{type:"element-active"}]},T={appendPadding:10,height:400,data:c==="current"?((x=h.data)===null||x===void 0?void 0:x.current.from)||[]:((s=n.data)===null||s===void 0?void 0:s.month.from)||[],angleField:"value",colorField:"type",radius:.8,loading:c==="current"?h.loading:n.loading,label:{type:"outer",content:"{name} {percentage}"},interactions:[{type:"pie-legend-active"},{type:"element-active"}]},j=(0,t.jsxs)(v.ZP,{split:"horizontal",children:[(0,t.jsx)(v.ZP,{bodyStyle:{padding:0},style:{marginTop:10},children:(0,t.jsx)(vt.ZP,{headerTitle:"\u5B89\u88C5\u91CF\u8BE6\u60C5",params:(0,$.Z)({},c==="current"?{type:1}:{type:2}),rowKey:"id",search:!1,request:F?P.Yd:P.Dz,scroll:{x:600},options:{fullScreen:!0,reload:!0,setting:!0},columns:O})}),(0,t.jsx)(v.ZP,{collapsible:!0,title:"TOP10\u5B89\u88C5\u91CF\u5E94\u7528",style:{position:"relative"},bodyStyle:{height:"auto"},children:(c==="current"?(((Z=h.data)===null||Z===void 0?void 0:Z.current.rank)||[]).length===0:(((C=n.data)===null||C===void 0?void 0:C.month.rank)||[]).length===0)?(0,t.jsx)(N.Z,{image:N.Z.PRESENTED_IMAGE_SIMPLE}):(0,t.jsx)(K.Z,(0,$.Z)({},M))}),(0,t.jsx)(v.ZP,{collapsible:!0,title:"\u5E94\u7528\u5B89\u88C5\u6765\u6E90",style:{position:"relative"},bodyStyle:{height:"auto"},children:(c==="current"?(((b=h.data)===null||b===void 0?void 0:b.current.from)||[]).length===0:(((m=n.data)===null||m===void 0?void 0:m.month.from)||[]).length===0)?(0,t.jsx)(N.Z,{image:N.Z.PRESENTED_IMAGE_SIMPLE}):(0,t.jsx)(K.Z,(0,$.Z)({},T))})]});return(0,t.jsx)(q.Z,{children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.Suspense,{fallback:(0,t.jsx)(G.Z,{}),children:(0,t.jsx)(tt,{loading:h.loading,active:(B=h.data)===null||B===void 0?void 0:B.base})}),(0,t.jsxs)(u.Suspense,{fallback:(0,t.jsx)(G.Z,{}),children:[(0,t.jsx)(k.Z,{offsetTop:et.M,style:{overflow:"hidden"},children:(0,t.jsxs)(v.ZP,{className:_().tabs,tabs:{tabPosition:"top",size:"large",activeKey:c,onChange:function(g){L(g),g==="month"&&!n.data&&!n.loading&&n.run()}},style:{boxShadow:"0 0 5px #00000044"},children:[(0,t.jsx)(v.ZP.TabPane,{tab:"\u4ECA\u65E5",cardProps:{bodyStyle:{padding:0,display:"none"}}},"current"),(0,t.jsx)(v.ZP.TabPane,{tab:"\u672C\u6708",cardProps:{bodyStyle:{padding:0,display:"none"}}},"month")]})}),(0,t.jsx)(v.ZP,{bodyStyle:{padding:0},children:j})]})]})})},yt=mt,Ut=a(14965),gt=a(14072),Lt=a(64896),xt=a(37744),Qt=a(57663),W=a(71577),Nt=a(58024),nt=a(39144),Gt=a(20228),Zt=a(11382),lt=a(65476),jt=a(84744),St=a(97221),Y=a(57845),It=a(46360),Ct=a.n(It),bt=a(30381),i=a.n(bt);function rt(o){for(var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,r=o.indexOf("/"),e=0;e<d&&r!==-1;e++)r=o.indexOf("/",r+1);return r!==-1?o.substr(0,r):o}var Et=function(d){var r,e=d.showAll,x=d.userId,s=d.appId,Z=d.setAppId,C=u.useState("current"),b=(0,A.Z)(C,2),m=b[0],B=b[1],F=u.useState(s===""?[]:[{value:s,label:(0,t.jsx)(Zt.Z,{size:"small"}),disabled:!0}]),S=(0,A.Z)(F,2),U=S[0],D=S[1],c=u.useRef({from:!0,install:!0}),L=u.useState({start:0,end:0}),h=(0,A.Z)(L,2),n=h[0],O=h[1];function M(p){return T.apply(this,arguments)}function T(){return T=(0,w.Z)(Q().mark(function p(l){return Q().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.abrupt("return",(0,jt.yC)((0,$.Z)((0,$.Z)({search:l},e?{all:e}:{}),x!==0?{userId:x}:{})));case 1:case"end":return E.stop()}},p)})),T.apply(this,arguments)}var j=(0,f.QT)(function(){return(0,P.sg)({current:!0,base:!0,appId:s})},{manual:s===""}),y=(0,f.QT)(function(){return(0,P.oQ)({appId:s,stat:"install",type:m,start:n.start,end:n.end})},{manual:s===""}),g=(0,f.QT)(function(){return(0,P.oQ)({appId:s,stat:"from",type:m,start:n.start,end:n.end})},{manual:s===""}),I=function(l){c.current.from?g.run():g.reset(),c.current.install?y.run():y.reset(),l&&j.run()},Tt=function(l){var z=n.start!==0&&l.format("X")/86400-n.start/24>365,E=n.end!==0&&n.end/24-l.format("X")/86400>365;return l&&l>i()().endOf("day")||E||z};(0,Y.e)(function(){I(!0)},[s]),(0,Y.e)(function(){I(!1)},[m]),(0,Y.e)(function(){!(m==="custom"&&(n.start===0||n.end===0))&&I(!1)},[n]),(0,u.useEffect)(function(){var p,l;D([{value:(p=j.data)===null||p===void 0?void 0:p.id,label:(l=j.data)===null||l===void 0?void 0:l.title}])},[j.data]);var Bt=(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(lt.Z,(0,$.Z)((0,$.Z)({showSearch:!0},s===""?{}:{value:s}),{},{placeholder:"\u9009\u62E9\u5E94\u7528",fetchOptions:M,setMyOption:U,style:{minWidth:"200px",maxWidth:"350px"},onChange:function(l){Z(l),f.m8.push(rt(f.m8.location.pathname)+"/"+l)}}))}),Dt={appendPadding:10,height:400,data:g.data||[],angleField:"value",colorField:"type",radius:.8,loading:g.loading,label:{type:"outer",content:"{name} {percentage}"},interactions:[{type:"pie-legend-active"},{type:"element-active"}]},Rt=m==="custom"&&(n.start===0||n.end===0)?(0,t.jsx)(nt.Z,{bordered:!1,children:"\u8BF7\u9009\u62E9\u4E00\u4E2A\u65F6\u95F4\u6BB5"}):(0,t.jsxs)(v.ZP,{split:"horizontal",children:[(0,t.jsx)(v.ZP,{collapsible:!0,title:"\u5E94\u7528\u91CF\u8D8B\u52BF",bodyStyle:{height:"auto",position:"relative"},onCollapse:function(l){c.current.install=!l,!y.data&&y.run()},children:(0,t.jsx)(St.Z,{loading:y.loading||!y.data,height:300,data:y.data||[],xField:"x",yField:"y",seriesField:"type",isStack:!0,xAxis:{visible:!0},yAxis:{visible:!0,title:{visible:!1}},slider:{start:0,end:1},title:{visible:!0,text:"\u5B89\u88C5\u91CF\u8D8B\u52BF",style:{fontSize:14}},meta:{y:{alias:"\u5B89\u88C5\u91CF"}}})}),(0,t.jsx)(v.ZP,{collapsible:!0,title:"\u5E94\u7528\u5B89\u88C5\u6765\u6E90",bodyStyle:{height:"auto",position:"relative"},onCollapse:function(l){c.current.from=!l,!g.data&&g.run()},children:(0,t.jsx)(K.Z,(0,$.Z)({},Dt))})]});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(xt.Z,{className:Ct().header,title:Bt,subTitle:"\u7684\u7EDF\u8BA1\u4FE1\u606F",extra:s&&(0,t.jsxs)(W.Z.Group,{children:[(0,t.jsx)(W.Z,{onClick:function(){f.m8.push(rt(f.m8.location.pathname,1)+"/instance/"+s)},children:"\u6D3B\u8DC3\u7EDF\u8BA1"}),(0,t.jsx)(W.Z,{onClick:function(){f.m8.push("/app/detail/"+s)},children:"\u5E94\u7528\u8BE6\u60C5"})]}),style:{padding:0,marginBottom:20}}),s?(0,t.jsx)(q.Z,{children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.Suspense,{fallback:(0,t.jsx)(G.Z,{}),children:(0,t.jsx)(tt,{loading:j.loading,active:(r=j.data)===null||r===void 0?void 0:r.base})}),(0,t.jsxs)(u.Suspense,{fallback:(0,t.jsx)(G.Z,{}),children:[(0,t.jsx)(k.Z,{offsetTop:et.M,style:{overflow:"hidden"},children:(0,t.jsxs)(v.ZP,{className:_().tabs,tabs:{tabPosition:"top",size:"middle",activeKey:m,onChange:function(l){B(l)}},style:{boxShadow:"0 0 5px #00000044"},children:[(0,t.jsx)(v.ZP.TabPane,{tab:"\u8FD124\u5C0F\u65F6",cardProps:{bodyStyle:{padding:0}}},"current"),(0,t.jsx)(v.ZP.TabPane,{tab:"\u672C\u6708",cardProps:{bodyStyle:{padding:0}}},"month"),(0,t.jsx)(v.ZP.TabPane,{tab:(0,t.jsxs)(t.Fragment,{children:["\u81EA\u5B9A\u4E49:",(0,t.jsx)(gt.Z.RangePicker,{bordered:!1,disabledDate:Tt,ranges:{\u4ECA\u65E5:[i()(),i()()],\u672C\u5468:[i()().startOf("week"),i()()],\u672C\u6708:[i()().startOf("month"),i()()],\u8FC7\u53BB7\u5929:[i()().subtract(7,"day"),i()()],\u8FC7\u53BB30\u5929:[i()().subtract(30,"day"),i()()],\u8FC7\u53BB60\u5929:[i()().subtract(60,"day"),i()()],\u8FC7\u53BB90\u5929:[i()().subtract(90,"day"),i()()],\u8FC7\u53BB120\u5929:[i()().subtract(120,"day"),i()()],\u8FC7\u53BB180\u5929:[i()().subtract(180,"day"),i()()],\u8FC7\u53BB360\u5929:[i()().subtract(360,"day"),i()()]},onCalendarChange:function(l){var z,E;return O(l?{start:parseInt(((z=l[0])===null||z===void 0?void 0:z.startOf("day").format("X"))/3600)|0,end:parseInt(((E=l[1])===null||E===void 0?void 0:E.startOf("day").format("X"))/3600)|0}:{start:0,end:0})}})]}),cardProps:{bodyStyle:{padding:0}}},"custom")]})}),(0,t.jsx)(v.ZP,{bodyStyle:{padding:0},children:Rt})]})]})}):(0,t.jsx)(nt.Z,{bodyStyle:{textAlign:"center"},children:"\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u5E94\u7528"})]})},Pt=Et,Ft=a(6637);function At(o){return V.apply(this,arguments)}function V(){return V=(0,w.Z)(Q().mark(function o(d){return Q().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,Ft.y)({search:d}));case 1:case"end":return e.stop()}},o)})),V.apply(this,arguments)}var $t=function(o){var d=o.route.name==="all-install",r=u.useState(o.match.params.appId?o.match.params.appId:""),e=(0,A.Z)(r,2),x=e[0],s=e[1],Z=u.useRef(x?"detail":"overview"),C=(0,f.tT)("admin"),b=C.selectedUser,m=C.setData,B=(0,u.useState)(b.value),F=(0,A.Z)(B,2),S=F[0],U=F[1],D=(0,t.jsx)(yt,{showAll:d,userId:S}),c=(0,t.jsx)(Pt,{showAll:d,userId:S,appId:x,setAppId:s}),L=u.useState(x?c:D),h=(0,A.Z)(L,2),n=h[0],O=h[1];(0,u.useEffect)(function(){M()},[S,x]);var M=function(){Z.current==="overview"?O(D):O(c)};return(0,t.jsx)(it.ZP,{tabList:[{tab:"\u6982\u89C8",key:"overview"},{tab:"\u8BE6\u7EC6\u8D8B\u52BF",key:"detail"}],tabActiveKey:Z.current,content:d&&(0,t.jsxs)(t.Fragment,{children:["\u5F00\u53D1\u8005\uFF1A",(0,t.jsx)(lt.Z,{showAll:!0,showSearch:!0,setMyOption:[b],placeholder:"\u9009\u62E9\u7528\u6237",fetchOptions:At,defaultValue:S,style:{width:"250px"},onChange:function(j,y){U(j),m({label:y.label,value:y.value})}})]}),onTabChange:function(j){Z.current=j,M()},children:n})}}}]);
