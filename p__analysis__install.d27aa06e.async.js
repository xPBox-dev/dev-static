(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[110],{33053:function(w){w.exports={tabs:"tabs___2_QYX"}},55457:function(w,k,a){"use strict";a.r(k),a.d(k,{default:function(){return Tt}});var A=a(33565),q=a(57361),dt=a(9754),G=a.n(dt),ot=a(19797),Dt=a(3515),_=a(86288),R=a(96132),Rt=a(13254),K=a(14277),Ot=a(22385),ut=a(69713),ct=a(37730),tt=a(21349),X=a(23723),u=a(67294),v=a(84787),vt=a(33053),et=a.n(vt),f=a(21010),ht=a(93660),W=a(7110),O=a(56905),U=a(52778),pt=a(4084),t=a(85893),V=U.Z.Statistic,ft=U.Z.Divider,mt=function(i){var l=i.loading,e=i.active,g=(0,u.useState)(!1),r=(0,A.Z)(g,2),x=r[0],I=r[1];return(0,t.jsx)(pt.Z,{onResize:function(y){I(y.width<696)},children:(0,t.jsxs)(U.Z.Group,{loading:l,direction:x?"column":"row",style:{marginBottom:24},children:[(0,t.jsx)(U.Z,{statistic:{title:"\u4ECA\u65E5\u5B89\u88C5\u91CF",value:(e==null?void 0:e.current)||0,description:(0,t.jsx)(V,{title:"\u672C\u6708\u5CF0\u503C",value:(e==null?void 0:e.max)||0})}}),(0,t.jsx)(ft,{type:x?"horizontal":"vertical"}),(0,t.jsx)(U.Z,{statistic:{title:"\u6628\u65E5\u5B89\u88C5\u91CF",value:e==null?void 0:e.yesterday,description:(0,t.jsx)(V,{title:"\u524D\u65E5\u540C\u6BD4",value:(e==null?void 0:e.yc)==="-"?"-":(e==null?void 0:e.yc)+"%",trend:(e==null?void 0:e.yc)<0?"down":"up"})},chartPlacement:"left"}),(0,t.jsx)(U.Z,{statistic:{title:"\u672C\u6708\u5B89\u88C5\u91CF",value:e==null?void 0:e.month,description:(0,t.jsx)(V,{title:"\u4E0A\u6708\u540C\u6BD4",value:(e==null?void 0:e.mc)==="-"?"-":(e==null?void 0:e.mc)+"%",trend:(e==null?void 0:e.mc)<0?"down":"up"})},chartPlacement:"left"})]})},"resize-observer")},at=mt;function nt(d){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,l=d.indexOf("/"),e=0;e<i&&l!==-1;e++)l=d.indexOf("/",l+1);return l!==-1?d.substr(0,l):d}var yt=function(i){var l,e,g,r,x,I,C,y,M,$,S,z=i.showAll,T=i.userId,E=u.useState("current"),Q=(0,A.Z)(E,2),h=Q[0],c=Q[1];u.useEffect(function(){p.run(),h==="current"?o.reset():o.run()},[T]);var p=(0,f.QT)(function(){return z?(0,O.K1)({current:!0,base:!0,userId:T}):(0,O.P)({current:!0,base:!0})},{manual:!0}),o=(0,f.QT)(function(){return z?(0,O.K1)({month:!0,userId:T}):(0,O.P)({month:!0})},{manual:!0}),B=[{title:"\u5E94\u7528\u540D",dataIndex:"appName",key:"appName",render:function(P,F){return(0,t.jsx)(ut.Z,{placement:"top",title:F.appId,children:(0,t.jsx)("a",{onClick:function(){return f.m8.push(nt(f.m8.location.pathname)+"/"+F.id)},children:P})})}}].concat((0,ct.Z)(z?[{title:"\u7528\u6237",dataIndex:"userId",key:"userId",copyable:!0,render:function(P,F){return(0,t.jsxs)(t.Fragment,{children:[F.nick," (",F.email,")"]})}}]:[]),[{title:"\u5E94\u7528\u5546\u5E97\u5B89\u88C5",dataIndex:"install_store",key:"install_store",hideInSearch:!0},{title:"\u5E94\u7528ID\u5B89\u88C5",dataIndex:"install_app_id",key:"install_app_id",hideInSearch:!0},{title:"\u6587\u4EF6\u5B89\u88C5",dataIndex:"install_file",key:"install_file",hideInSearch:!0},{title:"\u5E94\u7528\u5B89\u88C5",dataIndex:"install_app",key:"install_app",hideInSearch:!0},{title:"\u542F\u52A8\u5668\u5B89\u88C5",dataIndex:"install_loader",key:"install_loader",hideInSearch:!0}]),j={appendPadding:10,height:400,data:h==="current"?((l=p.data)===null||l===void 0?void 0:l.current.rank)||[]:((e=o.data)===null||e===void 0?void 0:e.month.rank)||[],angleField:"value",colorField:"type",radius:.8,loading:h==="current"?p.loading:o.loading,label:{type:"outer",content:"{name} {percentage}"},onReady:function(P){P.on("element:click",function(F){f.m8.push(nt(f.m8.location.pathname)+"/"+F.data.data.id)})},interactions:[{type:"pie-legend-active"},{type:"element-active"}]},Z={appendPadding:10,height:400,data:h==="current"?((g=p.data)===null||g===void 0?void 0:g.current.from)||[]:((r=o.data)===null||r===void 0?void 0:r.month.from)||[],angleField:"value",colorField:"type",radius:.8,loading:h==="current"?p.loading:o.loading,label:{type:"outer",content:"{name} {percentage}"},interactions:[{type:"pie-legend-active"},{type:"element-active"}]},D=(0,t.jsxs)(v.ZP,{split:"horizontal",children:[(0,t.jsx)(v.ZP,{bodyStyle:{padding:0},style:{marginTop:10},children:(0,t.jsx)(ht.ZP,{headerTitle:"\u5B89\u88C5\u91CF\u8BE6\u60C5",dataSource:h==="current"?((x=p.data)===null||x===void 0?void 0:x.current.list)||[]:((I=o.data)===null||I===void 0?void 0:I.month.list)||[],loading:h==="current"?p.loading:o.loading,rowKey:"id",search:!1,scroll:{x:600},options:{fullScreen:!0,reload:!0,setting:!0},columns:B})}),(0,t.jsx)(v.ZP,{collapsible:!0,title:"TOP10\u5B89\u88C5\u91CF\u5E94\u7528",style:{position:"relative"},bodyStyle:{height:"auto"},children:(h==="current"?(((C=p.data)===null||C===void 0?void 0:C.current.rank)||[]).length===0:(((y=o.data)===null||y===void 0?void 0:y.month.rank)||[]).length===0)?(0,t.jsx)(K.Z,{image:K.Z.PRESENTED_IMAGE_SIMPLE}):(0,t.jsx)(W.Z,(0,R.Z)({},j))}),(0,t.jsx)(v.ZP,{collapsible:!0,title:"\u5E94\u7528\u5B89\u88C5\u6765\u6E90",style:{position:"relative"},bodyStyle:{height:"auto"},children:(h==="current"?(((M=p.data)===null||M===void 0?void 0:M.current.from)||[]).length===0:((($=o.data)===null||$===void 0?void 0:$.month.from)||[]).length===0)?(0,t.jsx)(K.Z,{image:K.Z.PRESENTED_IMAGE_SIMPLE}):(0,t.jsx)(W.Z,(0,R.Z)({},Z))})]});return(0,t.jsx)(tt.Z,{children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.Suspense,{fallback:(0,t.jsx)(X.Z,{}),children:(0,t.jsx)(at,{loading:p.loading,active:(S=p.data)===null||S===void 0?void 0:S.base})}),(0,t.jsxs)(u.Suspense,{fallback:(0,t.jsx)(X.Z,{}),children:[(0,t.jsx)(_.Z,{offsetTop:47,style:{overflow:"hidden"},children:(0,t.jsxs)(v.ZP,{className:et().tabs,tabs:{tabPosition:"top",size:"large",activeKey:h,onChange:function(P){c(P),P==="month"&&!o.data&&!o.loading&&o.run()}},style:{boxShadow:"0 0 5px #00000044"},children:[(0,t.jsx)(v.ZP.TabPane,{tab:"\u4ECA\u65E5",cardProps:{bodyStyle:{padding:0,display:"none"}}},"current"),(0,t.jsx)(v.ZP.TabPane,{tab:"\u672C\u6708",cardProps:{bodyStyle:{padding:0,display:"none"}}},"month")]})}),(0,t.jsx)(v.ZP,{bodyStyle:{padding:0},children:D})]})]})})},gt=yt,Mt=a(14965),xt=a(14072),zt=a(64896),jt=a(37744),Lt=a(57663),Y=a(71577),Ut=a(58024),lt=a(39144),Qt=a(20228),Zt=a(11382),rt=a(65476),St=a(84744),It=a(97221),H=a(57845),Ct=a(46360),bt=a.n(Ct),Et=a(30381),s=a.n(Et);function st(d){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,l=d.indexOf("/"),e=0;e<i&&l!==-1;e++)l=d.indexOf("/",l+1);return l!==-1?d.substr(0,l):d}var Pt=function(i){var l,e=i.showAll,g=i.userId,r=i.appId,x=i.setAppId,I=u.useState("current"),C=(0,A.Z)(I,2),y=C[0],M=C[1],$=u.useState(r===""?[]:[{value:r,label:(0,t.jsx)(Zt.Z,{size:"small"}),disabled:!0}]),S=(0,A.Z)($,2),z=S[0],T=S[1],E=u.useRef({from:!0,install:!0}),Q=u.useState({start:0,end:0}),h=(0,A.Z)(Q,2),c=h[0],p=h[1];function o(m){return B.apply(this,arguments)}function B(){return B=(0,q.Z)(G().mark(function m(n){return G().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.abrupt("return",(0,St.yC)((0,R.Z)((0,R.Z)({search:n},e?{all:e}:{}),g!==0?{userId:g}:{})));case 1:case"end":return b.stop()}},m)})),B.apply(this,arguments)}var j=(0,f.QT)(function(){return(0,O.sg)({current:!0,base:!0,appId:r})},{manual:r===""}),Z=(0,f.QT)(function(){return(0,O.oQ)({appId:r,stat:"install",type:y,start:c.start,end:c.end})},{manual:r===""}),D=(0,f.QT)(function(){return(0,O.oQ)({appId:r,stat:"from",type:y,start:c.start,end:c.end})},{manual:r===""}),L=function(n){E.current.from?D.run():D.reset(),E.current.install?Z.run():Z.reset(),n&&j.run()},P=function(n){var N=c.start!==0&&n.format("X")/86400-c.start/24>365,b=c.end!==0&&c.end/24-n.format("X")/86400>365;return n&&n>s()().endOf("day")||b||N};(0,H.e)(function(){L(!0)},[r]),(0,H.e)(function(){L(!1)},[y]),(0,H.e)(function(){!(y==="custom"&&(c.start===0||c.end===0))&&L(!1)},[c]),(0,u.useEffect)(function(){var m,n;T([{value:(m=j.data)===null||m===void 0?void 0:m.id,label:(n=j.data)===null||n===void 0?void 0:n.title}])},[j.data]);var F=(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(rt.Z,(0,R.Z)((0,R.Z)({showSearch:!0},r===""?{}:{value:r}),{},{placeholder:"\u9009\u62E9\u5E94\u7528",fetchOptions:o,setMyOption:z,style:{minWidth:"200px",maxWidth:"350px"},onChange:function(n){x(n),f.m8.push(st(f.m8.location.pathname)+"/"+n)}}))}),it={appendPadding:10,height:400,data:D.data||[],angleField:"value",colorField:"type",radius:.8,loading:D.loading,label:{type:"outer",content:"{name} {percentage}"},interactions:[{type:"pie-legend-active"},{type:"element-active"}]},Bt=y==="custom"&&(c.start===0||c.end===0)?(0,t.jsx)(lt.Z,{bordered:!1,children:"\u8BF7\u9009\u62E9\u4E00\u4E2A\u65F6\u95F4\u6BB5"}):(0,t.jsxs)(v.ZP,{split:"horizontal",children:[(0,t.jsx)(v.ZP,{collapsible:!0,title:"\u5E94\u7528\u91CF\u8D8B\u52BF",bodyStyle:{height:"auto",position:"relative"},onCollapse:function(n){E.current.install=!n,!Z.data&&Z.run()},children:(0,t.jsx)(It.Z,{loading:Z.loading||!Z.data,height:300,data:Z.data||[],xField:"x",yField:"y",seriesField:"type",isStack:!0,xAxis:{visible:!0},yAxis:{visible:!0,title:{visible:!1}},slider:{start:0,end:1},title:{visible:!0,text:"\u5B89\u88C5\u91CF\u8D8B\u52BF",style:{fontSize:14}},meta:{y:{alias:"\u5B89\u88C5\u91CF"}}})}),(0,t.jsx)(v.ZP,{collapsible:!0,title:"\u5E94\u7528\u5B89\u88C5\u6765\u6E90",bodyStyle:{height:"auto",position:"relative"},onCollapse:function(n){E.current.from=!n,!D.data&&D.run()},children:(0,t.jsx)(W.Z,(0,R.Z)({},it))})]});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(jt.Z,{className:bt().header,title:F,subTitle:"\u7684\u7EDF\u8BA1\u4FE1\u606F",extra:r&&(0,t.jsxs)(Y.Z.Group,{children:[(0,t.jsx)(Y.Z,{onClick:function(){f.m8.push(st(f.m8.location.pathname,1)+"/instance/"+r)},children:"\u6D3B\u8DC3\u7EDF\u8BA1"}),(0,t.jsx)(Y.Z,{onClick:function(){f.m8.push("/app/detail/"+r)},children:"\u5E94\u7528\u8BE6\u60C5"})]}),style:{padding:0,marginBottom:20}}),r?(0,t.jsx)(tt.Z,{children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.Suspense,{fallback:(0,t.jsx)(X.Z,{}),children:(0,t.jsx)(at,{loading:j.loading,active:(l=j.data)===null||l===void 0?void 0:l.base})}),(0,t.jsxs)(u.Suspense,{fallback:(0,t.jsx)(X.Z,{}),children:[(0,t.jsx)(_.Z,{offsetTop:47,style:{overflow:"hidden"},children:(0,t.jsxs)(v.ZP,{className:et().tabs,tabs:{tabPosition:"top",size:"middle",activeKey:y,onChange:function(n){M(n)}},style:{boxShadow:"0 0 5px #00000044"},children:[(0,t.jsx)(v.ZP.TabPane,{tab:"\u8FD124\u5C0F\u65F6",cardProps:{bodyStyle:{padding:0}}},"current"),(0,t.jsx)(v.ZP.TabPane,{tab:"\u672C\u6708",cardProps:{bodyStyle:{padding:0}}},"month"),(0,t.jsx)(v.ZP.TabPane,{tab:(0,t.jsxs)(t.Fragment,{children:["\u81EA\u5B9A\u4E49:",(0,t.jsx)(xt.Z.RangePicker,{bordered:!1,disabledDate:P,ranges:{\u4ECA\u65E5:[s()(),s()()],\u672C\u5468:[s()().startOf("week"),s()()],\u672C\u6708:[s()().startOf("month"),s()()],\u8FC7\u53BB7\u5929:[s()().subtract(7,"day"),s()()],\u8FC7\u53BB30\u5929:[s()().subtract(30,"day"),s()()],\u8FC7\u53BB60\u5929:[s()().subtract(60,"day"),s()()],\u8FC7\u53BB90\u5929:[s()().subtract(90,"day"),s()()],\u8FC7\u53BB120\u5929:[s()().subtract(120,"day"),s()()],\u8FC7\u53BB180\u5929:[s()().subtract(180,"day"),s()()],\u8FC7\u53BB360\u5929:[s()().subtract(360,"day"),s()()]},onCalendarChange:function(n){var N,b;return p(n?{start:parseInt(((N=n[0])===null||N===void 0?void 0:N.startOf("day").format("X"))/3600)|0,end:parseInt(((b=n[1])===null||b===void 0?void 0:b.startOf("day").format("X"))/3600)|0}:{start:0,end:0})}})]}),cardProps:{bodyStyle:{padding:0}}},"custom")]})}),(0,t.jsx)(v.ZP,{bodyStyle:{padding:0},children:Bt})]})]})}):(0,t.jsx)(lt.Z,{bodyStyle:{textAlign:"center"},children:"\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u5E94\u7528"})]})},Ft=Pt,At=a(6637);function $t(d){return J.apply(this,arguments)}function J(){return J=(0,q.Z)(G().mark(function d(i){return G().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,At.y)({search:i}));case 1:case"end":return e.stop()}},d)})),J.apply(this,arguments)}var Tt=function(d){var i=d.route.name==="all-install",l=u.useState(d.match.params.appId?d.match.params.appId:""),e=(0,A.Z)(l,2),g=e[0],r=e[1],x=u.useRef(g?"detail":"overview"),I=(0,f.tT)("admin"),C=I.selectedUser,y=I.setData,M=(0,u.useState)(C.value),$=(0,A.Z)(M,2),S=$[0],z=$[1],T=(0,t.jsx)(gt,{showAll:i,userId:S}),E=(0,t.jsx)(Ft,{showAll:i,userId:S,appId:g,setAppId:r}),Q=u.useState(g?E:T),h=(0,A.Z)(Q,2),c=h[0],p=h[1];(0,u.useEffect)(function(){o()},[S,g]);var o=function(){x.current==="overview"?p(T):p(E)};return(0,t.jsx)(ot.ZP,{tabList:[{tab:"\u6982\u89C8",key:"overview"},{tab:"\u8BE6\u7EC6\u8D8B\u52BF",key:"detail"}],tabActiveKey:x.current,content:i&&(0,t.jsxs)(t.Fragment,{children:["\u5F00\u53D1\u8005\uFF1A",(0,t.jsx)(rt.Z,{showAll:!0,showSearch:!0,setMyOption:[C],placeholder:"\u9009\u62E9\u7528\u6237",fetchOptions:$t,defaultValue:S,style:{width:"250px"},onChange:function(j,Z){z(j),y({label:Z.label,value:Z.value})}})]}),onTabChange:function(j){x.current=j,o()},children:c})}}}]);
